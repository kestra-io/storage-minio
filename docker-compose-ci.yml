volumes:
  minio-data:
    driver: local
  minio-data-tls:
    driver: local

services:
  minio:
    build:
      context: .
      dockerfile: Dockerfile.minio
    volumes:
      - minio-data:/data
    command: server /data --console-address ":9001"
    environment:
      MINIO_DOMAIN: localhost
      MINIO_ACCESS_KEY: AKIAIOSFODNN7EXAMPLE
      MINIO_SECRET_KEY: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
    ports:
      - 43819:9000
      - 9001:9001

  minio-tls:
    image: minio/minio
    volumes:
      - minio-data-tls:/data
      - ./src/test/resources/mtls:/root/.minio/certs:ro
    command: server /data
    environment:
      MINIO_ACCESS_KEY: accessKey
      MINIO_SECRET_KEY: secretKey
    ports:
      - 9443:9000

  mitmproxy:
    image: mitmproxy/mitmproxy
    ports:
      - "8888:8080"  # MITM proxy listens on 8080 inside container by default
    command: mitmdump --mode regular --listen-port 8080